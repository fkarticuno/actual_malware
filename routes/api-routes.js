// var db = require('../models');
var passport = require('../config/passport/passport');
var unirest = require('unirest');

module.exports = function(app, db) {
    app.post('/api/login', passport.authenticate('local'), function(req, res) {
        res.redirect('/api/profiles');
    });
    app.post('/api/signup', function(req, res) {
        console.log(req.body);
        db.User.create({
            username: req.body.username,
            password: req.body.password
        }).then(function() {
            res.redirect(307, '/api/login');
        }).catch(function(err) {
            console.log(err);
            res.json(err);
        });
    });

    // app.post('/api/search', function(req, res) {
    // VAR DRINK CAPTURES INPUT FROM SEARCH 

//     var request = require("request");

// var options = {
//     method: 'GET',
//     url: 'https://the-cocktail-db.p.rapidapi.com/search.php',
//     qs: {
//         s: drink
//     },
//     headers: {
//         'x-rapidapi-host': 'the-cocktail-db.p.rapidapi.com',
//         'x-rapidapi-key': 'b3f7b0f883msh108b8d1a704e540p1448c0jsnbbfb21b9c9b4'
//     }
// };

// request(options, function (error, response, body) {
//     if (error) throw new Error(error);

//     console.log(JSON.parse(response.body[0].drinks.strDrink));
// });
    

// });

    app.get('/api/logout', function(req, res) {
        req.logout();
        res.redirect('/');
        
    });

    app.get('/api/profiles', function(req, res){
        res.redirect('/profiles')
    });

    app.get('/api/user_data', function(req, res) {
        if(!req.user) {
            res.json({});
        } else {
            res.json({
                username: req.user.username,
                id: req.user.id
            });
        }
    });

    app.post("/api/favorite", function(req, res){
        var drink = req.body.favorite;
            var req = unirest("GET", "https://the-cocktail-db.p.rapidapi.com/search.php");
    // SET "i" TO DRINK AND IT WILL POP THAT INTO THE SEARCH
    req.query({
        "s": drink
    });
    console.log("IM HERE")   
req.headers({
	"x-rapidapi-host": "the-cocktail-db.p.rapidapi.com",
	"x-rapidapi-key": "b3f7b0f883msh108b8d1a704e540p1448c0jsnbbfb21b9c9b4"
});

req.end(function (res, next) {
    if (res.error) throw new Error(res.error);
    var data = res.body.drinks[0];
    console.log(data);
    db.Cocktails.create({
        cocktailName: data.strDrink,
        cocktailInstructions: data.strInstructions,
        cocktailIngredients: data.strIngredient1,
        cocktailMeasurements: data.strMeasure1,
        cocktailFavorite: "true"
    })
});
       
    });

}; 