module.exports = function (app, db) {
    var express = require("express");
    var name, image, ingredients, instructions;
    var app = express();


    app.get("/", function (req, res) {
        var obj = {
            ...name,
            ...image,
            ...ingredients,
            ...instructions
        }
        res.render("index", obj);
        drinksCall();

        res.json();
    });

    app.post("/")

    

axios({
    "method":"GET",
    "url":"https://the-cocktail-db.p.rapidapi.com/list.php",
    "headers":{
    "content-type":"application/octet-stream",
    "x-rapidapi-host":"the-cocktail-db.p.rapidapi.com",
    "x-rapidapi-key":"dfbff340a2msha529254c12d9ca0p1bb047jsnf383ddb75530"
    },"params":{
    "a":"list"
    }
    })
    .then((response)=>{
      console.log(response)
    })
    .catch((error)=>{
      console.log(error)
    })
    
    function drinksCall() {
        var input = "tom"; //process.argv;
        console.log(input);
        var unirest = require("unirest");

        var req = unirest("GET", "https://www.thecocktaildb.com/api/json/v1/1/random.php");
        req.query({
            "a": "list"
        });
        req.headers({
            "x-rapidapi-host": "the-cocktail-db.p.rapidapi.com",
            "x-rapidapi-key": "1bb40a3f2cmsh737e756f49ff562p1d4980jsn6537251a9bc1"
        });

        req.end(function (res) {
            if (res.error) throw new Error(res.error);
            var cocktailArr = res.body.drinks[0];
            console.log("body:", res.body);
            console.log("spec:", res.body.drinks[0])
            console.log("==================", cocktailArr.strInstructions)
            name = {    
                drink_name: cocktailArr.strDrink
            }
            image = {
                drink_image: cocktailArr.strDrinkThumb
            }
            instructions = {
                drink_instructions: cocktailArr.strInstructions
            }

            ings = [];
            meas = [];
            ings.push(cocktailArr.strIngredient1, cocktailArr.strIngredient2, cocktailArr.strIngredient3, cocktailArr.strIngredient4,
                cocktailArr.strIngredient5, cocktailArr.strIngredient6, cocktailArr.strIngredient7, cocktailArr.strIngredient8,
                cocktailArr.strIngredient9, cocktailArr.strIngredient10, cocktailArr.strIngredient11, cocktailArr.strIngredient12,
                cocktailArr.strIngredient13, cocktailArr.strIngredient14, cocktailArr.strIngredient15
            )
            meas.push(cocktailArr.strMeasure1, cocktailArr.strMeasure2, cocktailArr.strMeasure3, cocktailArr.strMeasure4,
                cocktailArr.strMeasure5, cocktailArr.strMeasure6, cocktailArr.strMeasure7, cocktailArr.strMeasure8,
                cocktailArr.strMeasure9, cocktailArr.strMeasure10, cocktailArr.strMeasure11, cocktailArr.strMeasure12,
                cocktailArr.strMeasure13, cocktailArr.strMeasure14, cocktailArr.strMeasure15
            )
            var ingredientList = ings.map(function (ing, index) {
                if (ing) return {
                    ingredient: ing,
                    measurement: meas[index],
                }
                else return false

            }).filter(function (ing) {
                return ing
            })
            ingredients = {
                drink_ingredients: ingredientList
            }
            console.log(ingredientList);
        });
    }

}